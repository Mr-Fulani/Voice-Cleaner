"""
Модуль конфигурации с пресетами обработки.

Содержит централизованные параметры фильтров и несколько профилей
обработки (light, default, aggressive) для разных сценариев.

Параметры выбраны на основе практического опыта обработки речи:
- Light: минимальная обработка, сохраняет оригинальный характер звука
- Default: сбалансированная обработка для большинства случаев
- Aggressive: максимальное улучшение разборчивости, может добавить артефакты

Ограничения:
- Не работает хорошо на аудио с очень громкой музыкой
- Может исказить музыку, если она важна
- Требует наличия участков тишины для анализа шума
"""
from typing import Dict, Any

# Пресеты обработки
PRESETS: Dict[str, Dict[str, Any]] = {
    "light": {
        "description": "Минимальная обработка, сохраняет оригинальный характер звука",
        "highpass_freq": 80,  # Убираем инфранизкие частоты
        "lowpass_freq": 12000,  # Сохраняем больше высоких частот
        "noise_reduction": {
            "nr": 6,  # Мягкое шумоподавление
            "nt": "w"  # Wiener фильтр
        },
        "compressor": {
            "threshold": -24,  # Порог компрессии в dB
            "ratio": 2.5,  # Коэффициент сжатия
            "attack": 30,  # Время атаки в мс
            "release": 300  # Время восстановления в мс
        },
        "equalizer": {
            # Частотная коррекция: entry(частота, усиление в dB)
            "entries": [
                (100, 0),   # Низкие частоты без изменений
                (300, 2),   # Легкое усиление речевых частот
                (3000, 3),  # Усиление разборчивости
                (8000, -2)  # Небольшое снижение высоких частот
            ]
        },
        "limiter": {
            "limit": 0.98  # Мягкое ограничение
        },
        "noise_gate_threshold": -40  # Порог шумовых ворот в dB
    },
    
    "default": {
        "description": "Сбалансированная обработка для большинства случаев",
        "highpass_freq": 80,
        "lowpass_freq": 8000,  # Стандартная полоса для речи
        "noise_reduction": {
            "nr": 12,  # Среднее шумоподавление
            "nt": "w"
        },
        "compressor": {
            "threshold": -20,  # Более агрессивная компрессия
            "ratio": 3,
            "attack": 20,
            "release": 200
        },
        "equalizer": {
            "entries": [
                (100, 0),
                (300, 4),   # Усиление речевых частот
                (3000, 5),  # Усиление разборчивости
                (8000, -3)  # Снижение высоких частот для уменьшения шума
            ]
        },
        "limiter": {
            "limit": 0.95
        },
        "noise_gate_threshold": -35
    },
    
    "aggressive": {
        "description": "Максимальное улучшение разборчивости, может добавить артефакты",
        "highpass_freq": 100,  # Более агрессивная фильтрация низких частот
        "lowpass_freq": 7000,  # Более узкая полоса
        "noise_reduction": {
            "nr": 18,  # Сильное шумоподавление
            "nt": "w"
        },
        "compressor": {
            "threshold": -16,  # Агрессивная компрессия
            "ratio": 4,
            "attack": 15,
            "release": 150
        },
        "equalizer": {
            "entries": [
                (100, -2),  # Снижение низких частот
                (300, 6),   # Сильное усиление речевых частот
                (3000, 6),  # Максимальное усиление разборчивости
                (8000, -4)  # Сильное снижение высоких частот
            ]
        },
        "limiter": {
            "limit": 0.92
        },
        "noise_gate_threshold": -30
    },
    
    "test": {
        "description": "Тестовый пресет с очень заметными изменениями для демонстрации эффекта",
        "highpass_freq": 100,
        "lowpass_freq": 7000,
        "noise_reduction": {
            "nr": 15,
            "nt": "w"
        },
        "compressor": {
            "threshold": -18,
            "ratio": 4,
            "attack": 15,
            "release": 150
        },
        "equalizer": {
            "entries": [
                (100, -3),  # Снижение низких частот
                (300, 8),   # Сильное усиление речевых частот
                (3000, 8),  # Максимальное усиление разборчивости
                (8000, -5)  # Сильное снижение высоких частот
            ]
        },
        "limiter": {
            "limit": 0.92
        },
        "noise_gate_threshold": -30
    },
    
    "max_voice": {
        "description": "МАКСИМАЛЬНОЕ подавление музыки и шумов, максимальная разборчивость речи",
        "highpass_freq": 250,  # Экстремально агрессивная фильтрация - убираем весь бас
        "lowpass_freq": 3500,  # Очень узкая полоса - только основной речевой диапазон
        "noise_reduction": {
            "nr": 24,  # Максимальное шумоподавление - музыка как шум
            "nt": "w"
        },
        "compressor": {
            "threshold": -12,  # Очень агрессивная компрессия
            "ratio": 8,  # Максимальный коэффициент сжатия
            "attack": 5,  # Молниеносная атака
            "release": 80  # Быстрое восстановление
        },
        "equalizer": {
            "entries": [
                (30, -25),  # Максимальное подавление суббасов
                (50, -22),  # Экстремальное подавление басов
                (80, -20),  # Очень сильное подавление низких частот
                (120, -15), # Сильное подавление нижних частот музыки
                (180, -10), # Подавление средних низких частот
                (250, -5),  # Легкое подавление низких речевых частот
                (350, 12),  # Максимальное усиление основных речевых частот
                (600, 10),  # Сильное усиление нижних речевых частот
                (1000, 12), # Максимальное усиление средних речевых частот
                (1500, 10), # Усиление средних речевых частот
                (2200, 12), # Максимальное усиление разборчивости
                (2800, 10), # Усиление верхних речевых частот
                (3200, -8), # Подавление высоких частот
                (3500, -12) # Сильное подавление очень высоких частот
            ]
        },
        "limiter": {
            "limit": 0.85  # Очень строгое ограничение
        },
        "noise_gate_threshold": -24  # Очень агрессивный шумовой гейт
    },

    "center_voice": {
        "description": "Извлечение центрального канала + эквализация для голоса (если голос в центре, музыка по бокам)",
        "highpass_freq": 80,   # Мягкая фильтрация низких частот
        "lowpass_freq": 8000,  # Стандартная полоса
        "noise_reduction": {
            "nr": 12,  # Умеренное шумоподавление
            "nt": "w"
        },
        "compressor": {
            "threshold": -20,  # Стандартная компрессия
            "ratio": 4,        # Среднее сжатие
            "attack": 10,
            "release": 100
        },
        "equalizer": {
            "entries": [
                (100, -6),   # Умеренное подавление басов
                (300, 6),    # Усиление речевых частот
                (1000, 4),   # Усиление средних речевых
                (3000, 8),   # Усиление разборчивости
                (5000, -4),  # Подавление высоких шумов
                (8000, -8)   # Сильное подавление очень высоких
            ]
        },
        "limiter": {
            "limit": 0.95  # Стандартное ограничение
        },
        "noise_gate_threshold": -35,  # Мягкий шумовой гейт

        # Специальные настройки для center voice
        "center_extraction": True,   # Включить извлечение центрального канала
        "mono_mix": True,           # Преобразовать в моно для лучшего извлечения центра
        "voice_enhancement": True   # Дополнительное усиление речевых характеристик
    },

    "harmonic_voice": {
        "description": "Гармонический анализ + адаптивная фильтрация для максимального подавления музыки",
        "highpass_freq": 120,   # Средняя фильтрация низких частот
        "lowpass_freq": 6000,  # Широкая полоса для анализа
        "noise_reduction": {
            "nr": 16,  # Сильное шумоподавление
            "nt": "w"
        },
        "compressor": {
            "threshold": -18,  # Средняя компрессия
            "ratio": 5,        # Среднее сжатие
            "attack": 15,
            "release": 150
        },
        "equalizer": {
            "entries": [
                (80, -10),   # Подавление басов
                (150, -6),   # Подавление нижних частот музыки
                (250, -3),   # Легкое подавление
                (400, 4),    # Усиление нижних речевых
                (800, 6),    # Усиление средних речевых
                (1200, 5),   # Усиление средних
                (2400, 8),   # Максимальное усиление разборчивости
                (3500, 4),   # Усиление верхних речевых
                (5000, -6),  # Подавление высоких шумов
                (6000, -8)   # Сильное подавление очень высоких
            ]
        },
        "limiter": {
            "limit": 0.93  # Среднее ограничение
        },
        "noise_gate_threshold": -30,  # Средний шумовой гейт

        # Специальные настройки для harmonic voice
        "harmonic_analysis": True,    # Анализ гармоник для различения музыки/речи
        "dynamic_eq": True,          # Динамическая эквализация
        "spectral_subtraction": True # Спектральное вычитание
    },

    "ultra_clean": {
        "description": "УЛЬТРА очистка: комбинация всех техник для максимального качества",
        "highpass_freq": 180,   # Агрессивная фильтрация басов
        "lowpass_freq": 4500,  # Узкая полоса для чистоты
        "noise_reduction": {
            "nr": 20,  # Очень сильное шумоподавление
            "nt": "w"
        },
        "compressor": {
            "threshold": -15,  # Агрессивная компрессия
            "ratio": 6,        # Высокое сжатие
            "attack": 12,
            "release": 120
        },
        "equalizer": {
            "entries": [
                (60, -20),   # Экстремальное подавление суббасов
                (100, -15),  # Сильное подавление басов
                (180, -8),   # Подавление нижних частот
                (300, 8),    # Усиление речевых частот
                (600, 6),    # Усиление нижних речевых
                (1000, 8),   # Максимальное усиление средних речевых
                (1500, 6),   # Усиление средних
                (2500, 10),  # Максимальная разборчивость
                (3500, 4),   # Усиление верхних
                (4200, -4),  # Подавление высоких шумов
                (4500, -8)   # Сильное подавление края полосы
            ]
        },
        "limiter": {
            "limit": 0.88  # Строгое ограничение
        },
        "noise_gate_threshold": -28,  # Агрессивный гейт

        # Специальные настройки для ultra clean
        "center_extraction": True,   # Извлечение центра
        "mono_mix": False,          # Стерео для лучшего качества
        "voice_enhancement": True,  # Усиление речевых характеристик
        "harmonic_analysis": True,  # Анализ гармоник
        "dynamic_eq": True,         # Динамическая эквализация
        "spectral_subtraction": True # Спектральное вычитание
    }
}


def get_preset(name: str) -> Dict[str, Any]:
    """
    Получает пресет по имени.
    
    Args:
        name: Имя пресета (light, default, aggressive)
    
    Returns:
        Словарь с параметрами пресета
    
    Raises:
        ValueError: Если пресет с таким именем не существует
    """
    if name not in PRESETS:
        available = ", ".join(PRESETS.keys())
        raise ValueError(
            f"Пресет '{name}' не найден. Доступные пресеты: {available}"
        )
    
    return PRESETS[name].copy()  # Возвращаем копию, чтобы не изменять оригинал


def list_presets() -> list[str]:
    """
    Возвращает список доступных пресетов.
    
    Returns:
        Список имён пресетов
    """
    return list(PRESETS.keys())
