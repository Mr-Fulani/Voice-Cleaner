"""
Модуль конфигурации с пресетами обработки.

Содержит централизованные параметры фильтров и несколько профилей
обработки (light, default, aggressive) для разных сценариев.

Параметры выбраны на основе практического опыта обработки речи:
- Light: минимальная обработка, сохраняет оригинальный характер звука
- Default: сбалансированная обработка для большинства случаев
- Aggressive: максимальное улучшение разборчивости, может добавить артефакты

Ограничения:
- Не работает хорошо на аудио с очень громкой музыкой
- Может исказить музыку, если она важна
- Требует наличия участков тишины для анализа шума
"""
from typing import Dict, Any

# Пресеты обработки
PRESETS: Dict[str, Dict[str, Any]] = {
    "light": {
        "description": "Минимальная обработка, сохраняет оригинальный характер звука",
        "highpass_freq": 80,  # Убираем инфранизкие частоты
        "lowpass_freq": 12000,  # Сохраняем больше высоких частот
        "noise_reduction": {
            "nr": 6,  # Мягкое шумоподавление
            "nt": "w"  # Wiener фильтр
        },
        "compressor": {
            "threshold": -24,  # Порог компрессии в dB
            "ratio": 2.5,  # Коэффициент сжатия
            "attack": 30,  # Время атаки в мс
            "release": 300  # Время восстановления в мс
        },
        "equalizer": {
            # Частотная коррекция: entry(частота, усиление в dB)
            "entries": [
                (100, 0),   # Низкие частоты без изменений
                (300, 2),   # Легкое усиление речевых частот
                (3000, 3),  # Усиление разборчивости
                (8000, -2)  # Небольшое снижение высоких частот
            ]
        },
        "limiter": {
            "limit": 0.98  # Мягкое ограничение
        },
        "noise_gate_threshold": -40  # Порог шумовых ворот в dB
    },
    
    "default": {
        "description": "Сбалансированная обработка для большинства случаев",
        "highpass_freq": 80,
        "lowpass_freq": 8000,  # Стандартная полоса для речи
        "noise_reduction": {
            "nr": 12,  # Среднее шумоподавление
            "nt": "w"
        },
        "compressor": {
            "threshold": -20,  # Более агрессивная компрессия
            "ratio": 3,
            "attack": 20,
            "release": 200
        },
        "equalizer": {
            "entries": [
                (100, 0),
                (300, 4),   # Усиление речевых частот
                (3000, 5),  # Усиление разборчивости
                (8000, -3)  # Снижение высоких частот для уменьшения шума
            ]
        },
        "limiter": {
            "limit": 0.95
        },
        "noise_gate_threshold": -35
    },
    
    "aggressive": {
        "description": "Максимальное улучшение разборчивости, может добавить артефакты",
        "highpass_freq": 100,  # Более агрессивная фильтрация низких частот
        "lowpass_freq": 7000,  # Более узкая полоса
        "noise_reduction": {
            "nr": 18,  # Сильное шумоподавление
            "nt": "w"
        },
        "compressor": {
            "threshold": -16,  # Агрессивная компрессия
            "ratio": 4,
            "attack": 15,
            "release": 150
        },
        "equalizer": {
            "entries": [
                (100, -2),  # Снижение низких частот
                (300, 6),   # Сильное усиление речевых частот
                (3000, 6),  # Максимальное усиление разборчивости
                (8000, -4)  # Сильное снижение высоких частот
            ]
        },
        "limiter": {
            "limit": 0.92
        },
        "noise_gate_threshold": -30
    },
    
    "test": {
        "description": "Тестовый пресет с очень заметными изменениями для демонстрации эффекта",
        "highpass_freq": 100,
        "lowpass_freq": 7000,
        "noise_reduction": {
            "nr": 15,
            "nt": "w"
        },
        "compressor": {
            "threshold": -18,
            "ratio": 4,
            "attack": 15,
            "release": 150
        },
        "equalizer": {
            "entries": [
                (100, -3),  # Снижение низких частот
                (300, 8),   # Сильное усиление речевых частот
                (3000, 8),  # Максимальное усиление разборчивости
                (8000, -5)  # Сильное снижение высоких частот
            ]
        },
        "limiter": {
            "limit": 0.92
        },
        "noise_gate_threshold": -30
    },
    
    "max_voice": {
        "description": "МАКСИМАЛЬНОЕ подавление музыки и шумов, максимальная разборчивость речи",
        "highpass_freq": 200,  # Очень агрессивная фильтрация низких частот (музыка)
        "lowpass_freq": 5000,  # Узкая полоса - фокус на речевых частотах
        "noise_reduction": {
            "nr": 22,  # Очень сильное шумоподавление (музыка часто воспринимается как шум)
            "nt": "w"
        },
        "compressor": {
            "threshold": -14,  # Агрессивная компрессия для выравнивания
            "ratio": 6,  # Высокий коэффициент сжатия
            "attack": 8,  # Быстрая атака
            "release": 100  # Быстрое восстановление
        },
        "equalizer": {
            "entries": [
                (50, -18),  # Экстремальное подавление очень низких частот (басы музыки)
                (80, -15),  # Очень сильное подавление низких частот
                (100, -12), # Сильное подавление низких частот
                (150, -8),  # Подавление низких частот музыки
                (200, -5),  # Умеренное подавление нижних частот
                (300, 10),  # Максимальное усиление речевых частот
                (500, 8),   # Сильное усиление нижних речевых частот
                (1000, 10), # Максимальное усиление средних речевых частот
                (2000, 12), # Максимальное усиление разборчивости
                (3000, 10), # Сильное усиление верхних речевых частот
                (4000, -3), # Легкое подавление высоких частот
                (5000, -6)  # Подавление очень высоких частот (шипение, шумы)
            ]
        },
        "limiter": {
            "limit": 0.90  # Строгое ограничение
        },
        "noise_gate_threshold": -26  # Агрессивный шумовой гейт
    }
}


def get_preset(name: str) -> Dict[str, Any]:
    """
    Получает пресет по имени.
    
    Args:
        name: Имя пресета (light, default, aggressive)
    
    Returns:
        Словарь с параметрами пресета
    
    Raises:
        ValueError: Если пресет с таким именем не существует
    """
    if name not in PRESETS:
        available = ", ".join(PRESETS.keys())
        raise ValueError(
            f"Пресет '{name}' не найден. Доступные пресеты: {available}"
        )
    
    return PRESETS[name].copy()  # Возвращаем копию, чтобы не изменять оригинал


def list_presets() -> list[str]:
    """
    Возвращает список доступных пресетов.
    
    Returns:
        Список имён пресетов
    """
    return list(PRESETS.keys())
